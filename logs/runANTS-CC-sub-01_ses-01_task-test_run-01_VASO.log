[-] Unloading Matlab  2021a  on cn0888 
[+] Loading Matlab  2021a  on cn0888 
[-] Unloading matlab-spm, version 12.7219...
[+] Loading matlab-spm, version 12.7219...
[-] Unloading gcc  7.3.0  ... 
[-] Unloading ANTs  2.3.2 
[+] Loading gcc  7.3.0  ... 
[+] Loading ANTs  2.3.2 
[-] Unloading AFNI current-openmp  ... 
[+] Loading AFNI current-openmp  ... 
AFNI/current-openmp last updated  2021-09-28

[-] Unloading freesurfer  7.1.1 on cn0888 
[+] Loading freesurfer  7.1.1  on cn0888 
[-] Unloading FSL 6.0.4  ... 
[+] Loading FSL 6.0.4  ... 
[-] Unloading python 3.7  ... 
[+] Loading python 3.7  ... 
                        
EPI set using: /data/kleinrl/ds003216/derivatives/sub-01/VASO_func/sub-01_ses-01_task-test_run-01_VASO.nii
                                                         
----------------------------------
YOU NEED TO SUPPLY: 
               spm_path - location of spm files ('matlab_toolbox')
               ds_dir - location of data ('ds003216-download')
               EPI_base - currently working with 
                         'sub-01_ses-06_task-movie_run-05_VASO' 
                         main_anat.sh for processing MP2RAGE, then loop 
                         main_EPI.sh for each EPI
----------------------------------
project_dir: /home/kleinrl/projects/laminar_fmri
spm_path:    
tools_dir:   /home/kleinrl/projects/laminar_fmri/tools
cmds_dir:    /home/kleinrl/projects/laminar_fmri/cmds
EPI:         /data/kleinrl/ds003216/derivatives/sub-01/VASO_func/sub-01_ses-01_task-test_run-01_VASO.nii
EPI_base     sub-01_ses-01_task-test_run-01_VASO
----------------------------------
                                                                                
                                                                                
RUNNING: run_ANTS this will calculate the xfm from ANAT to EPI_mean and
and apply the xfm producing warped_MP2RAGE.nii
'warp_ANTS_resampleNN.sh <input_nii> <master_file>' will 
apply this xfm using nearestneighbor so only use with parcs
/data/kleinrl/ds003216/derivatives/sub-01/VASO_func/sub-01_ses-01_task-test_run-01_VASO_working_bias/muncorr.nii
/data/kleinrl/ds003216/sub-01/ses-01/anat/sub-01_ses-01_run-01_T1w.bias.nii
EPI_mean:             /data/kleinrl/ds003216/derivatives/sub-01/VASO_func/sub-01_ses-01_task-test_run-01_VASO_working_bias/muncorr.nii
ANAT:                 /data/kleinrl/ds003216/sub-01/ses-01/anat/sub-01_ses-01_run-01_T1w.bias.nii
dir_name:             /data/kleinrl/ds003216/derivatives/sub-01/VASO_func/sub-01_ses-01_task-test_run-01_VASO_working_bias
base_name:            muncorr.nii
working dir:          /data/kleinrl/ds003216/derivatives/sub-01/VASO_func/sub-01_ses-01_task-test_run-01_VASO_working_ANTs
creating working dir
I expect 2 files. the T1_weighted EPI.nii and a MP2RAGE_orig.nii (renzo)
we are using the T1_weighted EPI_bias corrected and MP2RAGE bias corrected
++ 3dcalc: AFNI version=AFNI_21.2.09 (Sep 27 2021) [64-bit]
++ Authored by: A cast of thousands
++ Output dataset ./MP2RAGE.nii
*****************************************
************* starting with ANTS ********
*****************************************
All_Command_lines_OK
Using single precision for computations.
=============================================================================
The composite transform comprises the following transforms (in order): 
  1. initial_matrix.txt (type = MatrixOffsetTransformBase)
=============================================================================
  number of levels = 2
  number of levels = 2
  number of levels = 2
  fixed image: EPI.nii
  moving image: MP2RAGE.nii
  fixed image: EPI.nii
  moving image: MP2RAGE.nii
  fixed image: EPI.nii
  moving image: MP2RAGE.nii
Dimension = 3
Number of stages = 3
Use Histogram Matching false
Winsorize image intensities true
Lower quantile = 0.005
Upper quantile = 0.995
Stage 1 State
   Image metric = CC
     Fixed image = Image (0x2dec420)
  RTTI typeinfo:   itk::Image<float, 3u>
  Reference Count: 2
  Modified Time: 1288
  Debug: Off
  Object Name: 
  Observers: 
    none
  Source: (none)
  Source output name: (none)
  Release Data: Off
  Data Released: False
  Global Release Data: Off
  PipelineMTime: 0
  UpdateMTime: 1071
  RealTimeStamp: 0 seconds 
  LargestPossibleRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [162, 216, 120]
  BufferedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [162, 216, 120]
  RequestedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [162, 216, 120]
  Spacing: [0.802469, 0.802469, 0.89]
  Origin: [-64.0361, 62.2044, -29.4552]
  Direction: 
1 0 0
0 -0.994881 -0.101056
0 -0.101056 0.994881

  IndexToPointMatrix: 
0.802469 0 0
0 -0.798361 -0.0899401
0 -0.0810945 0.885444

  PointToIndexMatrix: 
1.24615 0 0
0 -1.23977 -0.125932
0 -0.113546 1.11784

  Inverse Direction: 
1 0 0
0 -0.994881 -0.101056
0 -0.101056 0.994881

  PixelContainer: 
    ImportImageContainer (0x2dec6e0)
      RTTI typeinfo:   itk::ImportImageContainer<unsigned long, float>
      Reference Count: 1
      Modified Time: 1068
      Debug: Off
      Object Name: 
      Observers: 
        none
      Pointer: 0x2aaab0f8d010
      Container manages memory: true
      Size: 4199040
      Capacity: 4199040

     Moving image = Image (0x2dfb700)
  RTTI typeinfo:   itk::Image<float, 3u>
  Reference Count: 2
  Modified Time: 1289
  Debug: Off
  Object Name: 
  Observers: 
    none
  Source: (none)
  Source output name: (none)
  Release Data: Off
  Data Released: False
  Global Release Data: Off
  PipelineMTime: 0
  UpdateMTime: 1286
  RealTimeStamp: 0 seconds 
  LargestPossibleRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [320, 320, 240]
  BufferedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [320, 320, 240]
  RequestedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [320, 320, 240]
  Spacing: [0.65, 0.65, 0.65]
  Origin: [77.6828, -138.321, -102.731]
  Direction: 
-0 0 -1
1 -0 0
0 1 -0

  IndexToPointMatrix: 
0 0 -0.65
0.65 0 0
0 0.65 0

  PointToIndexMatrix: 
0 1.53846 0
0 0 1.53846
-1.53846 0 0

  Inverse Direction: 
0 1 0
0 0 1
-1 0 0

  PixelContainer: 
    ImportImageContainer (0x2ddff90)
      RTTI typeinfo:   itk::ImportImageContainer<unsigned long, float>
      Reference Count: 1
      Modified Time: 1283
      Debug: Off
      Object Name: 
      Observers: 
        none
      Pointer: 0x2aaab1f92010
      Container manages memory: true
      Size: 24576000
      Capacity: 24576000

     Weighting = 0.7
     Sampling strategy = regular
     Number of bins = 32
     Radius = 32
     Sampling percentage  = 0.1
   Transform = Rigid
     Gradient step = 0.05
     Update field sigma (voxel space) = 0
     Total field sigma (voxel space) = 0
     Update field time sigma = 0
     Total field time sigma  = 0
     Number of time indices = 0
     Number of time point samples = 0
Stage 2 State
   Image metric = Mattes
     Fixed image = Image (0x2df9cb0)
  RTTI typeinfo:   itk::Image<float, 3u>
  Reference Count: 2
  Modified Time: 1720
  Debug: Off
  Object Name: 
  Observers: 
    none
  Source: (none)
  Source output name: (none)
  Release Data: Off
  Data Released: False
  Global Release Data: Off
  PipelineMTime: 0
  UpdateMTime: 1503
  RealTimeStamp: 0 seconds 
  LargestPossibleRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [162, 216, 120]
  BufferedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [162, 216, 120]
  RequestedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [162, 216, 120]
  Spacing: [0.802469, 0.802469, 0.89]
  Origin: [-64.0361, 62.2044, -29.4552]
  Direction: 
1 0 0
0 -0.994881 -0.101056
0 -0.101056 0.994881

  IndexToPointMatrix: 
0.802469 0 0
0 -0.798361 -0.0899401
0 -0.0810945 0.885444

  PointToIndexMatrix: 
1.24615 0 0
0 -1.23977 -0.125932
0 -0.113546 1.11784

  Inverse Direction: 
1 0 0
0 -0.994881 -0.101056
0 -0.101056 0.994881

  PixelContainer: 
    ImportImageContainer (0x2df9fa0)
      RTTI typeinfo:   itk::ImportImageContainer<unsigned long, float>
      Reference Count: 1
      Modified Time: 1500
      Debug: Off
      Object Name: 
      Observers: 
        none
      Pointer: 0x2e01ac0
      Container manages memory: true
      Size: 4199040
      Capacity: 4199040

     Moving image = Image (0x2dfce10)
  RTTI typeinfo:   itk::Image<float, 3u>
  Reference Count: 2
  Modified Time: 1721
  Debug: Off
  Object Name: 
  Observers: 
    none
  Source: (none)
  Source output name: (none)
  Release Data: Off
  Data Released: False
  Global Release Data: Off
  PipelineMTime: 0
  UpdateMTime: 1718
  RealTimeStamp: 0 seconds 
  LargestPossibleRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [320, 320, 240]
  BufferedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [320, 320, 240]
  RequestedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [320, 320, 240]
  Spacing: [0.65, 0.65, 0.65]
  Origin: [77.6828, -138.321, -102.731]
  Direction: 
-0 0 -1
1 -0 0
0 1 -0

  IndexToPointMatrix: 
0 0 -0.65
0.65 0 0
0 0.65 0

  PointToIndexMatrix: 
0 1.53846 0
0 0 1.53846
-1.53846 0 0

  Inverse Direction: 
0 1 0
0 0 1
-1 0 0

  PixelContainer: 
    ImportImageContainer (0x2dff0b0)
      RTTI typeinfo:   itk::ImportImageContainer<unsigned long, float>
      Reference Count: 1
      Modified Time: 1715
      Debug: Off
      Object Name: 
      Observers: 
        none
      Pointer: 0x2aaab7d53010
      Container manages memory: true
      Size: 24576000
      Capacity: 24576000

     Weighting = 0.7
     Sampling strategy = regular
     Number of bins = 32
     Radius = 4
     Sampling percentage  = 0.1
   Transform = Affine
     Gradient step = 0.1
     Update field sigma (voxel space) = 0
     Total field sigma (voxel space) = 0
     Update field time sigma = 0
     Total field time sigma  = 0
     Number of time indices = 0
     Number of time point samples = 0
Stage 3 State
   Image metric = CC
     Fixed image = Image (0x2df81e0)
  RTTI typeinfo:   itk::Image<float, 3u>
  Reference Count: 2
  Modified Time: 2152
  Debug: Off
  Object Name: 
  Observers: 
    none
  Source: (none)
  Source output name: (none)
  Release Data: Off
  Data Released: False
  Global Release Data: Off
  PipelineMTime: 0
  UpdateMTime: 1935
  RealTimeStamp: 0 seconds 
  LargestPossibleRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [162, 216, 120]
  BufferedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [162, 216, 120]
  RequestedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [162, 216, 120]
  Spacing: [0.802469, 0.802469, 0.89]
  Origin: [-64.0361, 62.2044, -29.4552]
  Direction: 
1 0 0
0 -0.994881 -0.101056
0 -0.101056 0.994881

  IndexToPointMatrix: 
0.802469 0 0
0 -0.798361 -0.0899401
0 -0.0810945 0.885444

  PointToIndexMatrix: 
1.24615 0 0
0 -1.23977 -0.125932
0 -0.113546 1.11784

  Inverse Direction: 
1 0 0
0 -0.994881 -0.101056
0 -0.101056 0.994881

  PixelContainer: 
    ImportImageContainer (0x2dfb0b0)
      RTTI typeinfo:   itk::ImportImageContainer<unsigned long, float>
      Reference Count: 1
      Modified Time: 1932
      Debug: Off
      Object Name: 
      Observers: 
        none
      Pointer: 0x3e0a8f0
      Container manages memory: true
      Size: 4199040
      Capacity: 4199040

     Moving image = Image (0x3e09db0)
  RTTI typeinfo:   itk::Image<float, 3u>
  Reference Count: 2
  Modified Time: 2153
  Debug: Off
  Object Name: 
  Observers: 
    none
  Source: (none)
  Source output name: (none)
  Release Data: Off
  Data Released: False
  Global Release Data: Off
  PipelineMTime: 0
  UpdateMTime: 2150
  RealTimeStamp: 0 seconds 
  LargestPossibleRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [320, 320, 240]
  BufferedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [320, 320, 240]
  RequestedRegion: 
    Dimension: 3
    Index: [0, 0, 0]
    Size: [320, 320, 240]
  Spacing: [0.65, 0.65, 0.65]
  Origin: [77.6828, -138.321, -102.731]
  Direction: 
-0 0 -1
1 -0 0
0 1 -0

  IndexToPointMatrix: 
0 0 -0.65
0.65 0 0
0 0.65 0

  PointToIndexMatrix: 
0 1.53846 0
0 0 1.53846
-1.53846 0 0

  Inverse Direction: 
0 1 0
0 0 1
-1 0 0

  PixelContainer: 
    ImportImageContainer (0x3e0a070)
      RTTI typeinfo:   itk::ImportImageContainer<unsigned long, float>
      Reference Count: 1
      Modified Time: 2147
      Debug: Off
      Object Name: 
      Observers: 
        none
      Pointer: 0x2aaabdb14010
      Container manages memory: true
      Size: 24576000
      Capacity: 24576000

     Weighting = 1
     Sampling strategy = none
     Number of bins = 32
     Radius = 2
     Sampling percentage  = 1
   Transform = SyN
     Gradient step = 0.1
     Update field sigma (voxel space) = 2
     Total field sigma (voxel space) = 0
     Update field time sigma = 0
     Total field time sigma  = 0
     Number of time indices = 0
     Number of time point samples = 0
Registration using 3 total stages.

Stage 0
  iterations = 1000x500
  convergence threshold = 1e-06
  convergence window size = 10
  number of levels = 2
  using the CC metric (radius = 32, weight = 0.7)
  preprocessing:  winsorizing the image intensities
  Shrink factors (level 1 out of 2): [2, 2, 2]
  Shrink factors (level 2 out of 2): [1, 1, 1]
  smoothing sigmas per level: [1, 0]
  regular sampling (percentage = 0.1)

*** Running Euler3DTransform registration ***

DIAGNOSTIC,Iteration,metricValue,convergenceValue,ITERATION_TIME_INDEX,SINCE_LAST
 2DIAGNOSTIC,     1, -1.404789239168e-01, inf, 1.0536e+03, 1.0536e+03, 
 2DIAGNOSTIC,     2, -1.404789239168e-01, inf, 2.1014e+03, 1.0478e+03, 
 2DIAGNOSTIC,     3, -1.404789239168e-01, inf, 3.1484e+03, 1.0471e+03, 
 2DIAGNOSTIC,     4, -1.404789239168e-01, inf, 4.1719e+03, 1.0235e+03, 
 2DIAGNOSTIC,     5, -1.404789388180e-01, inf, 5.2070e+03, 1.0351e+03, 
 2DIAGNOSTIC,     6, -1.404789388180e-01, inf, 6.2407e+03, 1.0337e+03, 
 2DIAGNOSTIC,     7, -1.404789388180e-01, inf, 7.2753e+03, 1.0346e+03, 
 2DIAGNOSTIC,     8, -1.404789388180e-01, inf, 8.3161e+03, 1.0407e+03, 
 2DIAGNOSTIC,     9, -1.404789388180e-01, inf, 9.3534e+03, 1.0373e+03, 
 2DIAGNOSTIC,    10, -1.404789388180e-01, 3.190164761691e-06, 1.0389e+04, 1.0355e+03, 
 2DIAGNOSTIC,    11, -1.404789388180e-01, 2.898870661738e-06, 1.1430e+04, 1.0406e+03, 
 2DIAGNOSTIC,    12, -1.404789388180e-01, 2.655533762663e-06, 1.2471e+04, 1.0412e+03, 
 2DIAGNOSTIC,    13, -1.404789388180e-01, 2.449236262692e-06, 1.3492e+04, 1.0208e+03, 
 2DIAGNOSTIC,    14, -1.404789388180e-01, 2.272137407999e-06, 1.4525e+04, 1.0333e+03, 
 2DIAGNOSTIC,    15, -1.404789388180e-01, 2.120661520166e-06, 1.5556e+04, 1.0312e+03, 
 2DIAGNOSTIC,    16, -1.404789388180e-01, 1.988120175156e-06, 1.6598e+04, 1.0415e+03, 
 2DIAGNOSTIC,    17, -1.404789239168e-01, 1.869398715826e-06, 1.7634e+04, 1.0364e+03, 
 2DIAGNOSTIC,    18, -1.404789239168e-01, 1.764080138855e-06, 1.8672e+04, 1.0382e+03, 
 2DIAGNOSTIC,    19, -1.404789239168e-01, 1.670119445407e-06, 1.9698e+04, 1.0260e+03, 
 2DIAGNOSTIC,    20, -1.404789239168e-01, 1.585910013091e-06, 2.0726e+04, 1.0277e+03, 
 2DIAGNOSTIC,    21, -1.404789239168e-01, 1.510153083473e-06, 2.1763e+04, 1.0373e+03, 
 2DIAGNOSTIC,    22, -1.404789388180e-01, 1.443106611987e-06, 2.2800e+04, 1.0367e+03, 
 2DIAGNOSTIC,    23, -1.404789388180e-01, 1.382119535265e-06, 2.3837e+04, 1.0368e+03, 
 2DIAGNOSTIC,    24, -1.404789537191e-01, 1.327551672148e-06, 2.4866e+04, 1.0293e+03, 
 2DIAGNOSTIC,    25, -1.404789537191e-01, 1.277119167753e-06, 2.5903e+04, 1.0374e+03, 
 2DIAGNOSTIC,    26, -1.404789388180e-01, 1.229005306413e-06, 2.6924e+04, 1.0210e+03, 
 2DIAGNOSTIC,    27, -1.404789388180e-01, 1.182847768177e-06, 2.7958e+04, 1.0335e+03, 
 2DIAGNOSTIC,    28, -1.404789388180e-01, 1.139522510130e-06, 2.9151e+04, 1.1929e+03, 
 2DIAGNOSTIC,    29, -1.404789388180e-01, 1.098841607927e-06, 3.0175e+04, 1.0238e+03, 
 2DIAGNOSTIC,    30, -1.404789239168e-01, 1.059695819094e-06, 3.1210e+04, 1.0350e+03, 
 2DIAGNOSTIC,    31, -1.404789239168e-01, 1.023167783387e-06, 3.2239e+04, 1.0293e+03, 
DIAGNOSTIC,Iteration,metricValue,convergenceValue,ITERATION_TIME_INDEX,SINCE_LAST
 2DIAGNOSTIC,     1, -5.607243254781e-02, inf, 4.1474e+04, 9.2348e+03, 
 2DIAGNOSTIC,     2, -5.607243254781e-02, inf, 5.0576e+04, 9.1027e+03, 
 2DIAGNOSTIC,     3, -5.607243254781e-02, inf, 5.9614e+04, 9.0380e+03, 
 2DIAGNOSTIC,     4, -5.607243254781e-02, inf, 6.8665e+04, 9.0502e+03, 
 2DIAGNOSTIC,     5, -5.607243254781e-02, inf, 7.7881e+04, 9.2160e+03, 
 2DIAGNOSTIC,     6, -5.607243627310e-02, inf, 8.6923e+04, 9.0423e+03, 
 2DIAGNOSTIC,     7, -5.607243627310e-02, inf, 9.5890e+04, 8.9671e+03, 
 2DIAGNOSTIC,     8, -5.607243627310e-02, inf, 1.0489e+05, 8.9975e+03, 
 2DIAGNOSTIC,     9, -5.607243254781e-02, inf, 1.1383e+05, 8.9400e+03, 
 2DIAGNOSTIC,    10, -5.607243627310e-02, 3.185399918948e-06, 1.2283e+05, 8.9984e+03, 
 2DIAGNOSTIC,    11, -5.607243627310e-02, 2.895828174587e-06, 1.3189e+05, 9.0594e+03, 
